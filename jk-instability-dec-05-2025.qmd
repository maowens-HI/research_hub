---
title: "JK Instability"
date: "December 5, 2025"
format:
  html:
    toc: true
    toc-location: left
    toc-depth: 3
---

# Jackknife Classification Instability in Approach II

## Overview

Investigation into why the jackknife event-study graph shows a compressed "high predicted" trend compared to the baseline revealed a fundamental issue: **two states (Ohio and Texas)** have below-average spending growth for their high-baseline-spending counties, causing them to be misclassified as "high predicted" in the jackknife procedure.

------------------------------------------------------------------------

## 1. Initial Problem

### Observation

The baseline (full-sample) event-study showed clear separation between "high predicted" and "low predicted" spending groups. The jackknife version showed compressed, overlapping trends with the "high" group performing worse than expected.

![Event study estimates by baseline spending quartile](images/12_5_25/baseline_spec_A_def_A_high_vs_low.png){#fig-2-1-plot}

![Jackknife event study estimates - baseline spending only](images/12_5_25/jackknife_spec_A_def_A_high_vs_low.png){#fig-2-4-plot}

### Quantification

Tabulating `pre_q × high` (baseline spending quartile × high/low classification) revealed:

| Quartile  | Regular High | Jackknife High | Difference |
|-----------|---------------|----------------|------------|
| pre_q 1   | 3,080         | 3,080          | 0          |
| pre_q 2   | 3,136         | 3,136          | 0          |
| pre_q 3   | 0             | 504            | **+504**   |
| pre_q 4   | 0             | 336            | **+336**   |
| **Total** | 6,216         | 7,056          | **+840**   |

**Finding:** 840 observations from pre_q 3/4 (high-baseline-spending counties) flipped from "low" to "high" in the jackknife—counties that theoretically should have *lower* predicted spending increases.

------------------------------------------------------------------------

## 2. Diagnosis

### Step 1: Identify Which States Contributed the Flipped Observations

Tabulate `state_fips × high` for pre_q ≥ 3 counties in both baseline and jackknife datasets.

**Result:** All 840 flipped observations came from exactly **two states**: - Ohio (FIPS 39): 336 observations - Texas (FIPS 48): 504 observations

No other state had any pre_q 3/4 counties flip classification.

### Step 2: Compare Leave-Out Coefficients

I pulled the key coefficients from three event-study models, using lag 4 as the reference event-time. The main coefficient is the lag-4 effect for Q1 (the baseline quartile). The ppe3 and ppe4 coefficients show how much the lag-4 effect differs for counties in quartiles 3 and 4 compared to Q1. In other words, they tell us how baseline spending quartile shifts the 13-year average log-expenditure response at event-time 4.

```         
Full Sample:   main = 0.0179   ppe3 = -0.0199   ppe4 = -0.0298
Ohio:    main = 0.0124   ppe3 = -0.0157   ppe4 = -0.0112
Texas:   main = 0.0217   ppe3 = -0.0075   ppe4 = -0.0303
```

**Computed Predictions:**

| Model       | pred(q=3)   | pred(q=4)   |
|-------------|-------------|-------------|
| Full Sample | -0.0020     | -0.0119     |
| Ohio  | -0.0033     | **+0.0012** |
| Texas | **+0.0142** | -0.0086     |

**Finding:** - When Ohio is excluded, `ppe4` jumps from -0.030 to -0.011 (Δ = +0.019), pushing Ohio's pre_q 4 predictions above zero - When Texas is excluded, `ppe3` jumps from -0.020 to -0.008 (Δ = +0.012), pushing Texas's pre_q 3 predictions above zero

### Step 4: Examine Actual Spending Trajectories

Collapsed mean `lexp_ma_strict` by state group (Ohio/Texas/Other) for pre_q ≥ 3 counties over relative years 2-7 (the averaging window).

| State Group  | t=2   | t=7   | Change     |
|--------------|-------|-------|------------|
| Ohio         | 2.001 | 2.122 | +0.120     |
| Other States | 1.875 | 2.012 | **+0.137** |
| Texas        | 1.622 | 1.735 | +0.113     |

**Finding:** Ohio and Texas pre_q 3/4 counties have **flatter spending growth** than other states: - Ohio: 1.7 percentage points less growth than national average - Texas: 2.4 percentage points less growth than national average

------------------------------------------------------------------------

## 3. Root Cause Analysis

### The Mechanism

1.  **In the full sample:** Ohio and Texas pre_q 3/4 counties drag down the `ppe3` and `ppe4` interaction coefficients because their spending growth is below the national average for those quartiles.

2.  **In the jackknife:** Each state's counties receive predictions from a model that *excludes* that state:

    -   Ohio counties get predictions from the "leave-Ohio" model
    -   Texas counties get predictions from the "leave-Texas" model

3.  **The perverse result:** When Ohio/Texas are excluded from estimation, the remaining states' pre_q 3/4 spending growth looks *better* (because the below-average performers are removed). This makes the interaction coefficients less negative, pushing predictions above zero.

4.  **Classification flip:** Ohio's pre_q 4 counties and Texas's pre_q 3 counties cross the `pred_spend > 0` threshold and are classified as "high predicted."

### The Irony

Counties are classified as "high predicted" precisely *because* their own below-average performance is removed from the model that predicts them. The jackknife correctly uses out-of-sample predictions, but those predictions reflect what happened in *other* states—not what actually happened in Ohio/Texas.

------------------------------------------------------------------------

## 4. Why This Matters

### Contamination of the "High" Group

The "high predicted" group in the jackknife now contains: - Counties that genuinely had high predicted spending increases (correct) - Ohio pre_q 4 and Texas pre_q 3 counties that actually had *below-average* spending growth (contamination)

This contamination drags down the "high" group's average trajectory, compressing the difference between high and low groups in the event-study plot.

### Quantifying the Contamination

-   Total "high" in jackknife: 7,056 observations
-   Contaminated observations: 840 (Ohio pre_q 4 + Texas pre_q 3)
-   Contamination rate: **11.9%** of the "high" group

------------------------------------------------------------------------

## 5. Implications and Options

### Is This a Bug?

**No.** The code correctly implements leave-one-state-out predictions. Each state's counties receive predictions from a model excluding that state. The predictions are stored and assigned correctly.

### Is This Expected Behavior?

**Technically yes, but problematically so.** The jackknife is designed to create out-of-sample predictions to avoid overfitting. However, when individual states are highly influential (as Ohio and Texas are for pre_q 3/4), the leave-out predictions can diverge substantially from actual outcomes.

### Potential Solutions

1.  **Use Definition B (quartile-based) instead of Definition A (threshold-based)**
    -   Less sensitive to small coefficient changes crossing zero
    -   But the Ohio/Texas swap pattern suggests quartile rankings may also be unstable
2.  **Examine robustness to excluding Ohio and Texas entirely**
    -   Run analysis without these influential states
    -   Compare results to full-sample and jackknife versions
3.  **Use state-level clustering in the threshold**
    -   Instead of national `pred_spend > 0`, use within-state classifications
    -   Ensures each state's counties are compared to similar counties
4.  **Report both baseline and jackknife results**
    -   Acknowledge the instability as a limitation
    -   Jackknife may be overly conservative due to this contamination
5.  **Investigate why Ohio and Texas are different**
    -   Are there policy or demographic factors explaining their below-average growth?
    -   Could inform the heterogeneity analysis itself

------------------------------------------------------------------------

## 6. Technical Details

### Files Examined

-   `08_jackknife_approach_ii.do` (main analysis file)
-   `baseline_reg_A.dta` (baseline predictions)
-   `jk_reg_A.dta` (jackknife predictions)
-   `model_baseline_A.ster` (full-sample estimates)
-   `jackknife_A_state_39.ster` (leave-Ohio estimates)
-   `jackknife_A_state_48.ster` (leave-Texas estimates)

### Key Variables

-   `pre_q`: Baseline spending quartile (1971)
-   `pred_spend`: Predicted spending increase (average of lags 2-7)
-   `pred_q`: National quartile of predicted spending
-   `high_def_A`: Binary classification (pred_spend \> 0)
-   `lexp_ma_strict`: Log per-pupil expenditure (13-year rolling mean)

### Prediction Formula (Spec A)

```         
pred_spend = avg_main                    if pre_q == 1
pred_spend = avg_main + avg_ppe_2        if pre_q == 2
pred_spend = avg_main + avg_ppe_3        if pre_q == 3
pred_spend = avg_main + avg_ppe_4        if pre_q == 4

where avg_* = mean of coefficients across lags 2-7
```

------------------------------------------------------------------------

## 7. Conclusion

The jackknife classification instability is driven by two influential states (Ohio and Texas) whose pre_q 3/4 counties have below-average spending growth. The leave-one-state-out methodology causes these counties to be classified as "high predicted" based on other states' patterns, contaminating the high group with counties that actually underperformed.

This represents a limitation of the Approach II methodology when applied to samples with influential outlier states, rather than a coding error. The finding suggests caution in interpreting the jackknife heterogeneity results and motivates robustness checks excluding or separately examining Ohio and Texas.

------------------------------------------------------------------------
